<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shared Text</title>
</head>
<body>
<h1>Shared Text</h1>
<pre id="out"></pre>
<input id="textInput">

<script>

    const baseUrl = window.location.origin;

    const textInput = document.getElementById("textInput");

    const eventSource = new EventSource(baseUrl + '/sharedText');

    eventSource.addEventListener('sharedText', event => {
        textInput.value = JSON.parse(event.data).text;
    });
    eventSource.addEventListener('message', event => {
        console.warn("unknown event type",event);// handle events to which no type has been annotated
    });
    eventSource.addEventListener('error', err => {
        console.warn("SSE error", err);
    });

    textInput.oninput = _evt => {
        fetch(baseUrl + '/updateText?text='+textInput.value); // url encoding is automatic
    }


</script>

</body>
</html>
